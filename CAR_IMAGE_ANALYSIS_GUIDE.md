# ุฏููู ูุธุงู ุฑูุน ูุชุญููู ุตูุฑ ุงูุณูุงุฑุงุช
# Car Image Upload and Analysis System Guide

## ูุธุฑุฉ ุนุงูุฉ / Overview

ูุธุงู ุดุงูู ูุฑูุน ุตูุฑ ุงูุณูุงุฑุงุช ูุชุญููููุง ุขููุงู ุจุงุณุชุฎุฏุงู ุชูููุงุช ุงูุชุนูู ุงูุขูู ูุงูุชุนุฑู ุงูุถูุฆู ุนูู ุงูุญุฑูู (OCR).

A comprehensive system for uploading car images and automatically analyzing them using machine learning and OCR (Optical Character Recognition) technologies.

---

## ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ / Key Features

### 1. ุฑูุน ูุชุนุฏุฏ ููุตูุฑ / Multi-Image Upload
- โ ุฑูุน ุนุฏุฉ ุตูุฑ ูู ููุณ ุงูููุช
- โ ุฏุนู ุตูุบ: PNG, JPG, JPEG, GIF
- โ ูุนุงููุฉ ุงูุตูุฑ ูุจู ุงูุฑูุน
- โ ุงูุณุญุจ ูุงูุฅููุงุช (Drag & Drop)

### 2. ุงูุชุญููู ุงูุชููุงุฆู / Automatic Analysis
- ๐ **ุงุณุชุฎุฑุงุฌ ุฑูู ุงูููุญุฉ** ุจุงุณุชุฎุฏุงู EasyOCR (ุฏุนู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ)
- ๐ **ุชุญุฏูุฏ ููุน ุงูุณูุงุฑุฉ** ุชููุงุฆูุงู
- ๐จ **ุชุญุฏูุฏ ููู ุงูุณูุงุฑุฉ** ุจุงุณุชุฎุฏุงู ุชุญููู ุงูุฃููุงู
- ๐ **ุฏุฑุฌุฉ ุงูุซูุฉ** ููู ุชุญููู
- ๐ **ุฑุจุท ุชููุงุฆู** ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ

### 3. ุฅูุดุงุก ุงูุตูุฑ ุงููุตุบุฑุฉ / Thumbnail Generation
- ๐ธ ุฅูุดุงุก ุตูุฑ ูุตุบุฑุฉ ุชููุงุฆูุงู ููู ุตูุฑุฉ
- ๐พ ุชุฎุฒูู ูุนุงู ูููุณุงุญุฉ
- โก ุชุญููู ุณุฑูุน ููุนุฑุถ

### 4. ุฑุจุท ูุน ุงููุฎุงููุงุช / Violations Linking
- ๐ ุฑุจุท ุชููุงุฆู ูุน ุณุฌูุงุช ุงููุฎุงููุงุช ุงููุฑูุฑูุฉ
- ๐ ุนุฑุถ ุนุฏุฏ ุงููุฎุงููุงุช ููู ุณูุงุฑุฉ
- ๐ค ุนุฑุถ ูุนูููุงุช ุงููุงูู ุฅุฐุง ูุงูุช ุงูุณูุงุฑุฉ ูุณุฌูุฉ

### 5. ุงูุชุตุฏูุฑ ุงูุงุญุชุฑุงูู / Professional Export

#### ุชุตุฏูุฑ Excel (XLSX)
- ๐ ุชูุณูู ุงุญุชุฑุงูู ูุน ุฃููุงู ูุญุฏูุฏ
- ๐ผ๏ธ ุชุถููู ุงูุตูุฑ ุงููุตุบุฑุฉ
- ๐ ุงูุชุงุฑูุฎ ูุงูููุช ูู ุงูุฑุฃุณ
- ๐ฑ ุฏุนู RTL ููุนุฑุจูุฉ
- ๐จ ุชูุณูู ุดุฑุทู ููุจูุงูุงุช

#### ุชุตุฏูุฑ PDF
- ๐ ุชุฎุทูุท ุงุญุชุฑุงูู
- ๐ผ๏ธ ุตูุฑ ูุตุบุฑุฉ ุนุงููุฉ ุงูุฌูุฏุฉ
- ๐ ุฌุฏุงูู ููุธูุฉ
- ๐ ุฏุนู ูุชุนุฏุฏ ุงููุบุงุช

#### ุชุตุฏูุฑ HTML
- ๐ ุตูุญุฉ ููุจ ูุงููุฉ ูุชูุงุนููุฉ
- ๐ฑ ุชุตููู ูุชุฌุงูุจ (Responsive)
- ๐ ุฅุญุตุงุฆูุงุช ุชูุฎูุตูุฉ
- ๐จ ุชูุณูู ุฌุฐุงุจ ูุญุฏูุซ
- ๐จ๏ธ ุฌุงูุฒ ููุทุจุงุนุฉ

---

## ูุชุทูุจุงุช ุงููุธุงู / System Requirements

### ุงูููุชุจุงุช ุงููุทููุจุฉ / Required Libraries

```txt
Flask==2.3.3
Flask-CORS==4.0.0
Werkzeug==3.0.1
easyocr==1.7.1
pandas==2.2.0
xlsxwriter==3.2.0
reportlab==4.0.9
Pillow==10.2.0
Jinja2==3.1.3
```

### ุชุซุจูุช ุงููุชุทูุจุงุช / Installation

```bash
pip install -r requirements.txt
```

---

## ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช / Database Schema

### ุฌุฏูู `car_images`
ุชุฎุฒูู ูุนูููุงุช ุงูุตูุฑ ุงููุฑููุนุฉ

```sql
CREATE TABLE car_images (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    original_filename TEXT NOT NULL,
    image_path TEXT NOT NULL,
    thumbnail_path TEXT,
    uploaded_by INTEGER NOT NULL,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    processed INTEGER DEFAULT 0,
    FOREIGN KEY (uploaded_by) REFERENCES users (id)
);
```

### ุฌุฏูู `car_analysis`
ุชุฎุฒูู ูุชุงุฆุฌ ุงูุชุญููู

```sql
CREATE TABLE car_analysis (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    car_image_id INTEGER NOT NULL,
    plate_number TEXT,
    plate_confidence REAL,
    vehicle_type TEXT,
    vehicle_color TEXT,
    analysis_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    vehicle_id INTEGER,
    violation_count INTEGER DEFAULT 0,
    notes TEXT,
    FOREIGN KEY (car_image_id) REFERENCES car_images (id) ON DELETE CASCADE,
    FOREIGN KEY (vehicle_id) REFERENCES vehicles (id)
);
```

### ุฌุฏูู `car_violations_mapping`
ุฑุจุท ุงูุชุญูููุงุช ุจุงููุฎุงููุงุช

```sql
CREATE TABLE car_violations_mapping (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    car_analysis_id INTEGER NOT NULL,
    violation_id INTEGER NOT NULL,
    linked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    linked_by INTEGER,
    FOREIGN KEY (car_analysis_id) REFERENCES car_analysis (id) ON DELETE CASCADE,
    FOREIGN KEY (violation_id) REFERENCES traffic_violations (id) ON DELETE CASCADE,
    FOREIGN KEY (linked_by) REFERENCES users (id),
    UNIQUE(car_analysis_id, violation_id)
);
```

---

## ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช / API Endpoints

### 1. ุฑูุน ุงูุตูุฑ / Upload Images

**Endpoint:** `POST /api/car-images/upload`

**Authentication:** Required

**Request:**
- Content-Type: `multipart/form-data`
- Body: `images` (multiple files)

**Response:**
```json
{
  "success": true,
  "message": "Successfully uploaded and analyzed 3 images",
  "uploaded_images": [
    {
      "id": 1,
      "filename": "car1.jpg",
      "path": "/uploads/car_images/...",
      "thumbnail": "/uploads/thumbnails/..."
    }
  ],
  "analysis_results": [
    {
      "car_image_id": 1,
      "analysis_id": 1,
      "filename": "car1.jpg",
      "plate_number": "ุฃ ุจ ุฌ 1234",
      "vehicle_type": "ุณูุงุฑุฉ",
      "vehicle_color": "ุฃุจูุถ",
      "confidence": 0.92,
      "matched_vehicle": true,
      "vehicle_owner": "ูุญูุฏ ุฃุญูุฏ"
    }
  ]
}
```

### 2. ุงุณุชุนุฑุงุถ ุงูุชุญูููุงุช / Get Analysis Records

**Endpoint:** `GET /api/car-images/analysis`

**Authentication:** Required

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "plate_number": "ุฃ ุจ ุฌ 1234",
      "vehicle_type": "ุณูุงุฑุฉ",
      "vehicle_color": "ุฃุจูุถ",
      "plate_confidence": 0.92,
      "violation_count": 2,
      "owner_name": "ูุญูุฏ ุฃุญูุฏ",
      "analysis_date": "2025/01/15 14:30"
    }
  ],
  "count": 1
}
```

### 3. ุชุตุฏูุฑ ุงูุจูุงูุงุช / Export Data

**Endpoint:** `POST /api/car-images/export/{format}`

**Formats:** `excel`, `pdf`, `html`

**Authentication:** Required

**Response:** File download

---

## ุฏููู ุงูุงุณุชุฎุฏุงู / Usage Guide

### 1. ุงููุตูู ุฅูู ุงูุตูุญุฉ / Access the Page

ูู ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉุ ุงููุฑ ุนูู:
```
"ุฑูุน ูุชุญููู ุตูุฑ ุงูุณูุงุฑุงุช"
```

### 2. ุฑูุน ุงูุตูุฑ / Upload Images

**ุทุฑููุฉ 1: ุงูููุฑ ููุงุฎุชูุงุฑ**
1. ุงููุฑ ุนูู ููุทูุฉ ุงูุฑูุน
2. ุงุฎุชุฑ ุงูุตูุฑ ูู ุฌูุงุฒู
3. ุงูุชุธุฑ ูุนุงููุฉ ุงูุตูุฑ

**ุทุฑููุฉ 2: ุงูุณุญุจ ูุงูุฅููุงุช**
1. ุงุณุญุจ ุงูุตูุฑ ูู ุงููุฌูุฏ
2. ุฃููุชูุง ูู ููุทูุฉ ุงูุฑูุน
3. ุงูุชุธุฑ ูุนุงููุฉ ุงูุตูุฑ

### 3. ูุฑุงุฌุนุฉ ุงูุตูุฑ / Review Images

- ูุนุงููุฉ ูู ุตูุฑุฉ ูุจู ุงูุฑูุน
- ุฅุฒุงูุฉ ุฃู ุตูุฑุฉ ุบูุฑ ูุฑุบูุจุฉ
- ุงูุชุญูู ูู ุฃุณูุงุก ุงููููุงุช ูุฃุญุฌุงููุง

### 4. ุจุฏุก ุงูุชุญููู / Start Analysis

1. ุงููุฑ ุนูู ุฒุฑ "ุฑูุน ูุชุญููู ุงูุตูุฑ"
2. ุงูุชุธุฑ ุญุชู ููุชูู ุงูุชุญููู
3. ุงุทูุน ุนูู ุงููุชุงุฆุฌ ูู ุงูุฌุฏูู

### 5. ูุฑุงุฌุนุฉ ุงููุชุงุฆุฌ / Review Results

ุงูุฌุฏูู ูุนุฑุถ:
- โ ุฑูู ุงูููุญุฉ ุงููุณุชุฎุฑุฌ
- ๐ ููุน ุงูุณูุงุฑุฉ
- ๐จ ููู ุงูุณูุงุฑุฉ
- ๐ ุฏุฑุฌุฉ ุงูุซูุฉ ูู ุงูุชุนุฑู
- ๐ ูู ุงูุณูุงุฑุฉ ูุณุฌูุฉุ
- ๐ค ุงุณู ุงููุงูู (ุฅู ูุฌุฏ)
- โ๏ธ ุนุฏุฏ ุงููุฎุงููุงุช

### 6. ุชุตุฏูุฑ ุงูุจูุงูุงุช / Export Data

ุงุฎุชุฑ ุงูุชูุณูู ุงููุทููุจ:
- ๐ **Excel**: ููุชุญููู ูุงููุนุงูุฌุฉ
- ๐ **PDF**: ููุทุจุงุนุฉ ูุงููุดุงุฑูุฉ
- ๐ **HTML**: ููุนุฑุถ ุนูู ุงูููุจ

---

## ุงููุญุฏุงุช ุงูุจุฑูุฌูุฉ / Code Modules

### 1. `car_image_analyzer.py`
**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
- `init_easyocr_reader()` - ุชููุฆุฉ ูุงุฑุฆ EasyOCR
- `analyze_car_image(image_path)` - ุชุญููู ุตูุฑุฉ
- `extract_plate_number(text_results)` - ุงุณุชุฎุฑุงุฌ ุฑูู ุงูููุญุฉ
- `detect_vehicle_type(image)` - ุชุญุฏูุฏ ููุน ุงูุณูุงุฑุฉ
- `detect_vehicle_color(image)` - ุชุญุฏูุฏ ุงูููู
- `create_thumbnail(image_path, thumbnail_path)` - ุฅูุดุงุก ุตูุฑุฉ ูุตุบุฑุฉ
- `find_matching_vehicle(plate_number)` - ุงูุจุญุซ ุนู ุณูุงุฑุฉ ูุทุงุจูุฉ
- `save_car_analysis(car_image_id, analysis_result)` - ุญูุธ ุงููุชุงุฆุฌ

### 2. `car_data_exporter.py`
**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
- `export_to_excel(records, output_path)` - ุชุตุฏูุฑ Excel
- `export_to_pdf(records, output_path)` - ุชุตุฏูุฑ PDF
- `export_to_html(records, output_path)` - ุชุตุฏูุฑ HTML
- `get_car_analysis_records(filter_params)` - ุฌูุจ ุงูุณุฌูุงุช

### 3. Routes ูู `server.py`
- `POST /api/car-images/upload` - ุฑูุน ูุชุญููู
- `GET /api/car-images/analysis` - ุฌูุจ ุงูุชุญูููุงุช
- `POST /api/car-images/export/{format}` - ุชุตุฏูุฑ
- `GET /api/car-images/thumbnail/{id}` - ุฌูุจ ุตูุฑุฉ ูุตุบุฑุฉ

---

## ููููุฉ ุนูู ุงูุชุญููู / How Analysis Works

### 1. ุงุณุชุฎุฑุงุฌ ุงููุต (OCR)
```python
# ุชููุฆุฉ EasyOCR ูุน ุฏุนู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
reader = easyocr.Reader(['ar', 'en'], gpu=False)

# ูุฑุงุกุฉ ุงููุต ูู ุงูุตูุฑุฉ
ocr_results = reader.readtext(image_path)
```

### 2. ุงุณุชุฎุฑุงุฌ ุฑูู ุงูููุญุฉ
```python
# ุฃููุงุท ุงูุจุญุซ ุนู ุฃุฑูุงู ุงูููุญุงุช
plate_patterns = [
    r'[ุฃ-ู]{1,3}\s*\d{1,4}',  # ุญุฑูู ุนุฑุจูุฉ + ุฃุฑูุงู
    r'[A-Z]{1,3}\s*\d{1,4}',   # ุญุฑูู ุฅูุฌููุฒูุฉ + ุฃุฑูุงู
]

# ุงูุจุญุซ ุนู ุฃูุถู ูุทุงุจูุฉ
for detection in text_results:
    text = detection[1]
    confidence = detection[2]
    # ... ููุงุฑูุฉ ูุน ุงูุฃููุงุท
```

### 3. ุชุญุฏูุฏ ุงูููู
```python
# ุญุณุงุจ ูุชูุณุท RGB
pixels = list(image.getdata())
r_avg = sum(p[0] for p in pixels) / len(pixels)
g_avg = sum(p[1] for p in pixels) / len(pixels)
b_avg = sum(p[2] for p in pixels) / len(pixels)

# ุชุตููู ุงูููู
if r_avg > 200 and g_avg > 200 and b_avg > 200:
    return "ุฃุจูุถ"
elif r_avg < 50 and g_avg < 50 and b_avg < 50:
    return "ุฃุณูุฏ"
# ... ุงููุฒูุฏ ูู ุงูุชุตูููุงุช
```

---

## ูุตุงุฆุญ ููุงุณุชุฎุฏุงู ุงูุฃูุซู / Best Practices

### ุฌูุฏุฉ ุงูุตูุฑ / Image Quality
โ **ุงูุนู:**
- ุงุณุชุฎุฏู ุตูุฑ ุนุงููุฉ ุงูุฏูุฉ (1920x1080 ุฃู ุฃุนูู)
- ุชุฃูุฏ ูู ูุถูุญ ุงูููุญุฉ ูู ุงูุตูุฑุฉ
- ุงูุชูุท ุงูุตูุฑ ูู ุฅุถุงุกุฉ ุฌูุฏุฉ
- ุงุญุฑุต ุนูู ุฃู ุชููู ุงูููุญุฉ ููุงุฌูุฉ ูููุงููุฑุง

โ **ูุง ุชูุนู:**
- ุตูุฑ ููุฎูุถุฉ ุงูุฌูุฏุฉ ุฃู ุถุจุงุจูุฉ
- ููุญุงุช ุจุฒูุงูุง ุดุฏูุฏุฉ ุงูุงูุญุฑุงู
- ุตูุฑ ูู ุธุฑูู ุฅุถุงุกุฉ ุณูุฆุฉ
- ููุญุงุช ูุบุทุงุฉ ุฃู ูุชุณุฎุฉ

### ุงูุฃุฏุงุก / Performance
- ุฑูุน 10-20 ุตูุฑุฉ ูู ุงููุฑุฉ ุงููุงุญุฏุฉ ููุฃุฏุงุก ุงูุฃูุซู
- ุชุฌูุจ ุฑูุน ุตูุฑ ูุจูุฑุฉ ุฌุฏุงู (> 10 MB)
- ุงุณุชุฎุฏู ุตูุบุฉ JPEG ููุญุฌู ุงูุฃุตุบุฑ

### ุงูุฃูุงู / Security
- ุฌููุน ุงูุฑูุนูุงุช ูุณุฌูุฉ ูู ุณุฌู ุงููุฑุงุฌุนุฉ
- ุงููุฌูุฏุงุช ูุญููุฉ ูู ุงููุตูู ุงููุจุงุดุฑ
- ุงูุตูุฑ ูุฎุฒูุฉ ูู ูุฌูุฏุงุช ุขููุฉ ุฎุงุฑุฌ ุงูููุจ

---

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก / Troubleshooting

### ุงููุดููุฉ: ูุดู ูู ุงุณุชุฎุฑุงุฌ ุฑูู ุงูููุญุฉ
**ุงูุญููู:**
1. ุชุฃูุฏ ูู ูุถูุญ ุงูููุญุฉ ูู ุงูุตูุฑุฉ
2. ุฌุฑุจ ุตูุฑุฉ ุจุฅุถุงุกุฉ ุฃูุถู
3. ุชุฃูุฏ ูู ุฃู ุงูููุญุฉ ููุณุช ูุงุฆูุฉ ุจุดุฏุฉ

### ุงููุดููุฉ: ุฏูุฉ ููุฎูุถุฉ ูู ุงูุชุนุฑู
**ุงูุญููู:**
1. ุงุณุชุฎุฏู ุตูุฑ ุนุงููุฉ ุงูุฌูุฏุฉ
2. ุชุฃูุฏ ูู ูุธุงูุฉ ุงูููุญุฉ
3. ุงูุชูุท ุงูุตูุฑุฉ ูู ูุณุงูุฉ ููุงุณุจุฉ

### ุงููุดููุฉ: ูุดู ุงูุชุตุฏูุฑ
**ุงูุญููู:**
1. ุชุฃูุฏ ูู ูุฌูุฏ ุจูุงูุงุช ููุชุตุฏูุฑ
2. ุชุญูู ูู ุงูุฃุฐููุงุช ุนูู ูุฌูุฏ exports
3. ุชุฃูุฏ ูู ุชููุฑ ุงูููุชุจุงุช ุงููุทููุจุฉ

### ุงููุดููุฉ: ุจุทุก ูู ุงูุชุญููู
**ุงูุญููู:**
1. ููู ุนุฏุฏ ุงูุตูุฑ ุงููุฑููุนุฉ ุฏูุนุฉ ูุงุญุฏุฉ
2. ุงุณุชุฎุฏู ุตูุฑ ุจุญุฌู ูุนููู (< 5 MB)
3. ุชุญูู ูู ููุงุฑุฏ ุงูุฎุงุฏู

---

## ุงูุชุทููุฑ ุงููุณุชูุจูู / Future Development

### ูุญุชูู ุงูุฅุถุงูุฉ:
- [ ] ุฏุนู GPU ููุชุญููู ุงูุฃุณุฑุน
- [ ] ููุงุฐุฌ ุชุนูู ุขูู ูุชุตููู ุฃููุงุน ุงูุณูุงุฑุงุช
- [ ] ูุดู ุงูุฃุถุฑุงุฑ ูู ุงูุณูุงุฑุงุช
- [ ] ุชุญููู ูุชูุฏู ููุฃููุงู
- [ ] ุฏุนู ููุฏูู ูุงุณุชุฎุฑุงุฌ ุงูุฅุทุงุฑุงุช
- [ ] ุชูุงูู ูุน ูุงููุฑุงุช ุงููุฑุงูุจุฉ
- [ ] ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ูููุฎุงููุงุช ุงูุฌุฏูุฏุฉ
- [ ] ุชูุงุฑูุฑ ุฅุญุตุงุฆูุฉ ูุชูุฏูุฉ

---

## ุงููุณุงููุฉ / Contributing

ูุฑุญุจ ุจุฃู ูุณุงููุงุช ูุชุญุณูู ุงููุธุงู:
1. Fork ุงููุณุชูุฏุน
2. ุฃูุดุฆ ูุฑุนุงู ููููุฒุฉ ุงูุฌุฏูุฏุฉ
3. ูู ุจุงูุชุนุฏููุงุช
4. ุฃุฑุณู Pull Request

---

## ุงูุชุฑุฎูุต / License

ูุฐุง ุงููุธุงู ุฌุฒุก ูู ูุธุงู ุฅุฏุงุฑุฉ ุฅุณูุงู ุฃุนุถุงุก ููุฆุฉ ุงูุชุฏุฑูุณ
ยฉ 2025 ุฌููุน ุงูุญููู ูุญููุธุฉ

---

## ุงูุฏุนู / Support

ูููุณุงุนุฏุฉ ูุงูุฏุนู ุงูููู:
- ๐ง Email: support@university.edu.sa
- ๐ฑ Phone: +966-XX-XXXXXXX
- ๐ Website: [university.edu.sa](https://university.edu.sa)

---

## ุงูุฅุตุฏุงุฑ / Version

**ุงููุณุฎุฉ ุงูุญุงููุฉ:** 1.0.0  
**ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ:** 2025-01-15  
**ุงูุญุงูุฉ:** โ ูุณุชูุฑ ูุฌุงูุฒ ููุฅูุชุงุฌ
