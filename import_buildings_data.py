#!/usr/bin/env python3
"""
Import buildings data into the database
Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
"""

import sqlite3
import os

DATABASE_PATH = os.path.join(os.path.dirname(__file__), 'housing.db')

# Buildings data from CSV
buildings_data = [
    ("Ø¹Ù…Ø§Ø±Ø© 1", "1", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 2", "2", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 3", "3", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 4", "4", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 5", "5", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 6", "6", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 7", "7", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 19),
    ("Ø¹Ù…Ø§Ø±Ø© 8", "8", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 9", "9", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 10", "10", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 11", "11", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 12", "12", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 19),
    ("Ø¹Ù…Ø§Ø±Ø© 13", "13", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 19),
    ("Ø¹Ù…Ø§Ø±Ø© 14", "14", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 15", "15", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 16", "16", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 17", "17", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 18", "18", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 19", "19", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 20", "20", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 19),
    ("Ø¹Ù…Ø§Ø±Ø© 21", "21", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 22", "22", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 23", "23", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 24", "24", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 25", "25", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 19),
    ("Ø¹Ù…Ø§Ø±Ø© 26", "26", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 27", "27", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 28", "28", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 29", "29", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 30", "30", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "Ø´Ù‚Ø©", 19),
    ("Ø¹Ù…Ø§Ø±Ø© 53", "53", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 54", "54", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 55", "55", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 56", "56", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 61", "61", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 62", "62", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 63", "63", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 64", "64", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 65", "65", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 66", "66", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 67", "67", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 68", "68", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 71", "71", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 72", "72", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 73", "73", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 74", "74", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 75", "75", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 76", "76", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 77", "77", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 78", "78", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
    ("Ø¹Ù…Ø§Ø±Ø© 79", "79", "Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø´Ù‚Ø©", 20),
]

# Add villas (ÙÙ„Ù„)
for i in range(1, 115):  # 1 to 114
    buildings_data.append((f"ÙÙ„Ø© {i}", f"V{i}", "Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙÙ„Ù„", "ÙÙ„Ø©", 1))  # building_type not used in INSERT

def import_buildings():
    """Import buildings data into database"""
    try:
        conn = sqlite3.connect(DATABASE_PATH)
        cursor = conn.cursor()
        
        # Check if data already exists
        cursor.execute('SELECT COUNT(*) FROM buildings')
        count = cursor.fetchone()[0]
        
        if count > 0:
            print(f"âš ï¸  Database already contains {count} buildings")
            response = input("Do you want to clear and reimport? (y/n): ")
            if response.lower() != 'y':
                print("âŒ Import cancelled")
                conn.close()
                return
            
            # Clear existing data
            cursor.execute('DELETE FROM buildings')
            print("âœ… Existing buildings data cleared")
        
        # Insert buildings
        inserted = 0
        for name, building_number, address, building_type, total_units in buildings_data:
            try:
                cursor.execute('''
                    INSERT INTO buildings (name, building_number, address, total_units)
                    VALUES (?, ?, ?, ?)
                ''', (name, building_number, address, total_units))
                inserted += 1
            except sqlite3.IntegrityError as e:
                print(f"âš ï¸  Skipping duplicate: {name} - {e}")
        
        conn.commit()
        
        # Verify import
        cursor.execute('SELECT COUNT(*) FROM buildings')
        total = cursor.fetchone()[0]
        
        print("\n" + "=" * 60)
        print("âœ… Buildings import completed successfully!")
        print("âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø¨Ù†Ø¬Ø§Ø­!")
        print("=" * 60)
        print(f"ğŸ“Š Total buildings in database: {total}")
        print(f"ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: {total}")
        print("=" * 60)
        
        # Show summary by type
        cursor.execute('''
            SELECT 
                CASE 
                    WHEN address = 'Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©' THEN 'Ø¹Ù…Ø§Ø±Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©'
                    WHEN address = 'Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©' THEN 'Ø¹Ù…Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©'
                    WHEN address = 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙÙ„Ù„' THEN 'ÙÙ„Ù„'
                END as type,
                COUNT(*) as count,
                SUM(total_units) as total_units
            FROM buildings
            GROUP BY address
        ''')
        
        summary = cursor.fetchall()
        print("\nğŸ“ˆ Summary / Ø§Ù„Ù…Ù„Ø®Øµ:")
        print("-" * 60)
        for row in summary:
            print(f"  {row[0]}: {row[1]} Ù…Ø¨Ù†Ù‰ ({row[2]} ÙˆØ­Ø¯Ø©)")
        print("=" * 60)
        
        conn.close()
        return True
        
    except Exception as e:
        print(f"âŒ Error importing buildings: {e}")
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ: {e}")
        return False

if __name__ == '__main__':
    print("=" * 60)
    print("Buildings Data Import Script")
    print("Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ")
    print("=" * 60)
    import_buildings()
